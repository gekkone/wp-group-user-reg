jQuery('[name="enroll-course"]').chosen({no_results_text:"Курс не найден: ",allow_single_deselect:!0});var regUserPattern=document.querySelector(".reg-user-pattern");function init(){var e=cloneRegUser();document.querySelector(".reg-users").appendChild(e),checkRemoveUser(),document.querySelector(".user-reg-button").addEventListener("click",registerUser)}function registerUser(){var t=serializeFormData(document,["org-name","corp-email","phone","sity","enroll-course","org-id"]);t.users=[];var e,r,n=document.querySelectorAll(".reg-users .reg-user"),o=["firstname","lastname","post"];n.forEach(function(e){var r=serializeFormData(e,o);t.users.push(r)}),null===document.querySelector(".empty-input")?((e=new XMLHttpRequest).open("POST",document.querySelector('input[name="handler_url"]').value,!0),e.onreadystatechange=function(){if(4==e.readyState){var r;try{r=JSON.parse(e.responseText)}catch(e){r=null,console.error(e)}200==e.status?null!==r&&r.success?(alert("Пользователи зарегистрированы"),location.reload()):alert(r.data||"Не удалось зарегистрировать пользователей"):alert("Не удалось выполнить запрос."+("\n"+r.data||""))}},(r=new FormData).append("_wpnonce",document.querySelector('input[name="_wpnonce"]').value),r.append("action","group_reg_user"),r.append("data",JSON.stringify(t)),e.send(r)):alert("Некоторые поля обязательны для заполнения, но не были заполнены. Пожалуйста заполните поля выделенные красной обводкой")}function appendUser(e){var r=findParent(e.currentTarget,"reg-user");null!==r&&(r.after(cloneRegUser()),checkRemoveUser())}function removeUser(e){var r=findParent(e.currentTarget,"reg-user");null!==r&&(r.remove(),checkRemoveUser())}function checkRemoveUser(){var e=document.querySelectorAll(".reg-users .reg-user"),r=document.querySelector(".reg-user_control_remove");1<e.length?r.removeAttribute("disabled"):r.setAttribute("disabled",!0)}function initControlButton(e){e.querySelector(".reg-user_control_append").addEventListener("click",appendUser),e.querySelector(".reg-user_control_remove").addEventListener("click",removeUser)}function cloneRegUser(){var e=regUserPattern.cloneNode(!0);return e.classList.remove("reg-user-pattern"),e.removeAttribute("style"),initControlButton(e),e}function findParent(e,r){for(;null!==e&&!e.classList.contains(r);)e=e.parentElement;return e}function serializeFormData(e,r){for(var t={},n=0;n<r.length;++n){var o=r[n],a=e.querySelector('*[name="'+o+'"]');if(null===a)return void console.debug("Нет поля"+o);a.classList.contains("required-input")&&(0===a.value.length?a.classList.add("empty-input"):a.classList.remove("empty-input")),t[o]=a.value}return t}init();
