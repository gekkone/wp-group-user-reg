jQuery('[name="enroll-course"]').chosen({no_results_text:"Курс не найден: ",allow_single_deselect:!0});var regUserPattern=document.querySelector(".reg-user-pattern");function init(){var e=cloneRegUser();document.querySelector(".reg-users").appendChild(e),checkRemoveUser(),document.querySelector(".user-reg-button").addEventListener("click",registerUser)}function registerUser(e){var t=serializeFormData(document,["org-name","corp-email","phone","sity","enroll-course","org-id"]);t.users=[];var n,r,o=document.querySelectorAll(".reg-users .reg-user"),s=["firstname","lastname","post"];o.forEach(function(e){var r=serializeFormData(e,s);t.users.push(r)}),null===document.querySelector(".empty-input")?(e.currentTarget.setAttribute("sending",""),(n=new XMLHttpRequest).open("POST",document.querySelector('input[name="handler_url"]').value,!0),n.onreadystatechange=function(){if(4==n.readyState){var r;try{r=JSON.parse(n.responseText)}catch(e){r=null,console.error(e)}200==n.status?null!==r?r.success?(alert("Пользователи зарегистрированы"),location.reload()):alert(r.data):alert("Получен некорректный ответ сервера"):(alert("Не удалось выполнить запрос к серверу"),console.error(n))}},(r=new FormData).append("_wpnonce",document.querySelector('input[name="_wpnonce"]').value),r.append("action","group_reg_user"),r.append("data",JSON.stringify(t)),n.send(r)):alert("Некоторые поля обязательны для заполнения, но не были заполнены. Пожалуйста заполните поля выделенные красной обводкой"),e.currentTarget.removeAttribute("sending")}function appendUser(e){var r=findParent(e.currentTarget,"reg-user");null!==r&&(r.after(cloneRegUser()),checkRemoveUser())}function removeUser(e){var r=findParent(e.currentTarget,"reg-user");null!==r&&(r.remove(),checkRemoveUser())}function checkRemoveUser(){var e=document.querySelectorAll(".reg-users .reg-user"),r=document.querySelector(".reg-user_control_remove");1<e.length?r.removeAttribute("disabled"):r.setAttribute("disabled",!0)}function initControlButton(e){e.querySelector(".reg-user_control_append").addEventListener("click",appendUser),e.querySelector(".reg-user_control_remove").addEventListener("click",removeUser)}function cloneRegUser(){var e=regUserPattern.cloneNode(!0);return e.classList.remove("reg-user-pattern"),e.removeAttribute("style"),initControlButton(e),e}function findParent(e,r){for(;null!==e&&!e.classList.contains(r);)e=e.parentElement;return e}function serializeFormData(e,r){for(var t={},n=0;n<r.length;++n){var o=r[n],s=e.querySelector('*[name="'+o+'"]');if(null===s)return void console.debug("Нет поля"+o);if(s.classList.contains("required-input")&&(0===s.value.length?s.classList.add("empty-input"):s.classList.remove("empty-input")),"enroll-course"===o){for(var u=s.options,a=[],n=0,l=u.length;n<l;++n)opt=u[n],opt.selected&&a.push(opt.value);t[o]=a}else t[o]=s.value}return t}init();
